
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ConversationHandler, CallbackContext

TOKEN = os.getenv("TOKEN")

# Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ø§ (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)
accounts = {
    "user1": "pass123",
    "user2": "qwerty456",
    "client3": "secret789"
}

# Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
ASK_USERNAME, ASK_PASSWORD = range(2)

# Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ /start
async def start(update: Update, context: CallbackContext) -> None:
    message = """
Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚Ø§Øª ØŒ Ù„Ù‚Ø¯ ØªÙ… ØªØ·ÙˆÙŠØ±ÙŠ Ù…Ù† Ù‚Ø¨Ù„ Ø¯ÙˆÙ„Ø© Ø§Ù„Ù‡ÙƒØ± .
Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§ØªØŒ ÙˆÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¨ÙˆØªØŒ Ù‚Ù… Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±.
Ø§Ù„Ù…Ø·ÙˆØ± : @LML15 
"""
    await update.message.reply_text(message)

# Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ /login
async def login(update: Update, context: CallbackContext) -> int:
    await update.message.reply_text("ğŸ” ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:")
    return ASK_USERNAME

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async def check_username(update: Update, context: CallbackContext) -> int:
    username = update.message.text.strip()
    if username in accounts:
        context.user_data["username"] = username
        await update.message.reply_text("âœ… Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµØ­ÙŠØ­! \nØ§Ù„Ø¢Ù†ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:")
        return ASK_PASSWORD
    else:
        await update.message.reply_text("âŒ Ù„Ù… ÙŠØªÙ… Ø¥ÙŠØ¬Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨.")
        return ConversationHandler.END

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
async def check_password(update: Update, context: CallbackContext) -> int:
    password = update.message.text.strip()
    username = context.user_data.get("username")

    if accounts.get(username) == password:
        await update.message.reply_text(f"ğŸ‰ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ù…Ø±Ø­Ø¨Ù‹Ø§ {username}!\nØ§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙ…ØªØ¹ Ø¨Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¨ÙˆØª.")
    else:
        await update.message.reply_text("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.")
    
    return ConversationHandler.END

# ÙÙŠ Ø­Ø§Ù„ Ø£Ø±Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
async def cancel(update: Update, context: CallbackContext) -> int:
    await update.message.reply_text("ğŸš« ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.")
    return ConversationHandler.END

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙˆØª
def main() -> None:
    application = Application.builder().token(TOKEN).build()

    # Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    conv_handler = ConversationHandler(
        entry_points=[CommandHandler("login", login)],
        states={
            ASK_USERNAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, check_username)],
            ASK_PASSWORD: [MessageHandler(filters.TEXT & ~filters.COMMAND, check_password)],
        },
        fallbacks=[CommandHandler("cancel", cancel)],
    )

    # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    application.add_handler(CommandHandler("start", start))
    application.add_handler(conv_handler)

    # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª
    application.run_polling()

if __name__ == "__main__":
    main()
